<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dongduk.cs.ssd.dao.mybatis.mapper.OrderMapper">
  <cache />
  <sql id="BaseColumns">
  	orderId,
  	cardBank, cardNo, validDate, cvc,
  	address1, address2, address3,
  	phone,
  	refundBank, refundAccount,
  	totalPrice, <!-- 총 가격 -->
  	orderDate, <!-- 승인 일시 -->
  	userId
  </sql>
  
  <select id="getOrder" parameterType="int"
  		resultType="Order">
  	SELECT <include refid="BaseColumns" /> 
  	FROM orders
  	WHERE orderId = #{orderId}
  </select> <!-- Order를 가져옴 -->
  
   <insert id="createOrder" parameterType="Order">
  	INSERT INTO orders (<include refid="BaseColumns" />)
  	VALUES (#{orderId}, #{cardBank}, #{cardNo}, #{validDate}, #{cvc},
  		#{address1}, #{address2}, #{address3}, #{phone},
  		#{refundBank}, #{refundAccount}, #{totalPrice}, 
  		#{orderDate}, #{userId})
  </insert>
  
  <select id="getLineGroupBuys" parameterType="int"
  		resultType="LineGroupBuy">
  	SELECT lineId, quantity, selectOption, unitPrice, groupBuyId, orderId
  	FROM lineGroupBuys
  	WHERE orderId = #{orderId}	
  </select> <!-- orderId에 해당하는 LineGroupBuy list를 가져옴 -->
  
  <select id="getGroupBuyId" parameterType="int"
  		resultType="int">
  	SELECT DISTINCT groupBuyId
	FROM lineGroupBuys
	WHERE orderId = #{orderId};	
  </select>
  
  <select id="getAuctionId" parameterType="int"
  		resultType="int">
  	SELECT auctionId
	FROM successBidders
	WHERE orderId = #{orderId};	
  </select>
  
 </mapper>